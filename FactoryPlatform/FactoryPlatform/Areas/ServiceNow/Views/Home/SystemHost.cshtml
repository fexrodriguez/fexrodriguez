@model SystemHostViewModel
@{
    ViewData["Title"] = "SystemHost";
}
<div class="post d-flex flex-column-fluid" id="kt_post">
    <div id="kt_content_container" class="container-fluid">
        <!--begin::Card 1-->
        <form asp-area="ServiceNow" asp-controller="Home" asp-action="MainMenuTaksPartial" method="post">
            <div class="py-1" id="card1">
                <div class="rounded border p-3 card mb-1 mb-xl-3">
                    <div class="accordion accordion-icon-toggle" id="MainMenuPrincipal">
                        <div class="mb-5">
                            <div class="accordion-header py-3 d-flex" data-bs-toggle="collapse" data-bs-target="#MainMenu" aria-expanded="true">
                                <span class="accordion-icon">
                                    <span class="svg-icon svg-icon-4">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                            <rect opacity="0.5" x="18" y="13" width="13" height="2" rx="1" transform="rotate(-180 18 13)" fill="currentColor"></rect>
                                            <path d="M15.4343 12.5657L11.25 16.75C10.8358 17.1642 10.8358 17.8358 11.25 18.25C11.6642 18.6642 12.3358 18.6642 12.75 18.25L18.2929 12.7071C18.6834 12.3166 18.6834 11.6834 18.2929 11.2929L12.75 5.75C12.3358 5.33579 11.6642 5.33579 11.25 5.75C10.8358 6.16421 10.8358 6.83579 11.25 7.25L15.4343 11.4343C15.7467 11.7467 15.7467 12.2533 15.4343 12.5657Z" fill="currentColor"></path>
                                        </svg>
                                    </span>
                                </span>
                                <h3 class="fs-2 fw-bold mb-0 ms-4">Tasks Management - Main Menu</h3>
                            </div>
                            <div id="MainMenu" class="collapse show">
                                <div class="p-5">
                                    <div class="row g-2 g-xl-2 mb-2 pulse pulse-danger">
                                        @foreach (var item in Model.MainMenu)
                                        {
                                            var ColorActivo = item.Activo == true ? "animation-blink" : "";
                                            var color = item.Activo == true ? item.ColorActivo : item.Color;
                                            <div class="card me-4 mb-4 accordion-header" style="width:109px; height : 109px;">
                                                <div class="card-body  overflow-hidden position-relative d-flex justify-content-center text-center flex-column p-2" style=" border: thick double #@color; background-color:#@color; box-shadow: 5px 10px 10px 0px black">
                                                    <a  onclick="showReport(@item.ID_MenuSeccion)" class="text-white w3-btn w3-border">
                                                        <div class="symbol symbol-9px mb-2 @ColorActivo">
                                                            @if (item.Activo == true)
                                                            {
                                                                <span class="pulse-ring border-5"></span>
                                                            }
                                                            <i class="@item.MenuIconos fs-3x text-white "></i>
                                                        </div>
                                                        <div class="fs-8 fw-bold mb-1 p-0 text-white  ">@item.MenuSeccion</div>
                                                    </a>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <!--end::Card 1-->
        <!--begin::Card 2-->
        <form asp-area="ServiceNow" asp-controller="Home" asp-action="WorkOrdersPartial" method="post">
            @if (Model.ServicesMenu.Count > 0)
            {
                <div class="py-1" id="card2">
                    <div class="rounded border p-3 card mb-1 mb-xl-3">
                        <div class="accordion accordion-icon-toggle" id="ServicesMenuPrincipal">
                            <div class="mb-5">
                                <div class="accordion-header py-3 d-flex" data-bs-toggle="collapse" data-bs-target="#ServicesMenu" aria-expanded="true">
                                    <span class="accordion-icon">
                                        <span class="svg-icon svg-icon-4">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <rect opacity="0.5" x="18" y="13" width="13" height="2" rx="1" transform="rotate(-180 18 13)" fill="currentColor"></rect>
                                                <path d="M15.4343 12.5657L11.25 16.75C10.8358 17.1642 10.8358 17.8358 11.25 18.25C11.6642 18.6642 12.3358 18.6642 12.75 18.25L18.2929 12.7071C18.6834 12.3166 18.6834 11.6834 18.2929 11.2929L12.75 5.75C12.3358 5.33579 11.6642 5.33579 11.25 5.75C10.8358 6.16421 10.8358 6.83579 11.25 7.25L15.4343 11.4343C15.7467 11.7467 15.7467 12.2533 15.4343 12.5657Z" fill="currentColor"></path>
                                            </svg>
                                        </span>
                                    </span>
                                    <h3 class="fs-2 fw-bold mb-0 ms-4">Service Menu</h3>
                                </div>
                                @*                                <div id="ServicesMenu" class="collapse hide">
                                *@                                <div id="ServicesMenu" class="collapse show">
                                    <div class="p-5">
                                        <div class="row g-2 g-xl-2 mb-2 pulse pulse-danger">

                                            @foreach (var item in Model.ServicesMenu)
                                            {
                                                <div class="card me-4 mb-4 accordion-header " style="width:109px; height : 109px;">
                                                    <div class="card-body  overflow-hidden position-relative d-flex justify-content-center text-center flex-column p-2" style="border: thick double #@item.Colors; background-color:#@item.Colors; box-shadow: 5px 10px 10px 0px black">
                                                        <a  onclick="showCapture(@item.ID_MenuService)" class="text-white w3-btn w3-border  ">
                                                            <div class="symbol symbol-9px mb-2">
                                                                <i class="@item.MenuIconos fs-3x" style="color: #@item.FontColor"></i>
                                                            </div>
                                                            <div class="fs-8 fw-bold mb-1 p-0" style="color: #@item.FontColor">@item.MenuSeccion</div>
                                                        </a>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </form>
        <!--end::Card 2-->
        @*renderear tarjetas del Main Menu*@
        <div class="card shadow-sm" id="MainMenuTaskPartial">
            <partial name="MainMenuTaskPartial" model="@Model.MainMenuTaskViewModel" />
        </div>
        @*renderear tarjetas del Service now*@
        <div class="card shadow-sm" id="ServiceMenuPartial">
            <partial name="ServiceMenuPartial" model="@Model.ServiceMenuViewModel" />
        </div>
    </div>
</div>
@section Scripts {

@*loading*@
<script>
        var button = document.querySelector("#kt_content_container");
        var target = document.querySelector("#kt_content_container");

        var BlockPantalla = new KTBlockUI(target, {
            message: '<div class="blockui-message"><span class="spinner-border text-primary"></span> Loading...</div>',
        });
</script>

@*Show Reports*@
<script type="text/javascript">
    function showReport(partialView)
    {
        if(partialView != "")
        {
            BlockPantalla.block();

            $.ajax({
                url: "@Url.Action("MainMenuTaksPartial","Home")",
                type: "post",
                data: {IdMenuTask : partialView},
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("XSRF-TOKEN",
                        $('input:hidden[name="__RequestVerificationToken"]').val());
                    },

            }).done(function (result) 
            {
                if (result != null) 
                {
                        if (result == 'Error') {
                            SystemServerError()
                        }
                        else if (result == 'noSession') {
                            swalExpired()
                        }
                        else if (result == 'Sorry') {
                            swalNoAuthorized()
                        }
                        else if (result == 'NoPage') {
                            swalNoAuthorized()
                        }
                    else
                    {
                        BlockPantalla.release();
                        $("#MainMenuTaskPartial").html(result)
                        document.getElementById('MainMenuTaskPartial').style.display = 'block';
                        document.getElementById('card1').style.display = 'none';
                        document.getElementById('card2').style.display = 'none';

                        $("#kt_body").attr("data-kt-aside-minimize", "on")

                        var element = document.querySelector("#kt_stepper_example_basic");

                        //Validar que este el elemento para inicilizar ya que si no mandara mensaje de error
                        if (element != '' && element != null) {
                        // Initialize Stepper
                        var stepper = new KTStepper(element);
                        // Handle next step
                        stepper.on("kt.stepper.next", function (stepper) 
                        {
                            stepper.goNext(); // go next step
                        });
                        // Handle previous step
                        stepper.on("kt.stepper.previous", function (stepper) 
                        {
                            stepper.goPrevious(); // go previous step
                        });

                        stepper.on("kt.stepper.changed", function() 
                        {
                            stepper.getCurrentStepIndex();
                        });

                        stepper.on("kt.stepper.changed", function() 
                        {
                            var indice = stepper.getCurrentStepIndex();
                            if(indice == 3)
                            {
                                    //$('#CloseSteps').css("display", "block");
                                    $("#CloseSteps").removeAttr("style");
                                    $('#InfSteps').css("display", "block");
                                    $('#backInf').css("display", "block");
                                    $('#idDocReject').css("display", "none");
                                    $('#idDocRev').css("display", "none");
                                    //$('#idBack').addClass("btn-danger").removeClass("btn-light");
                            }
                            else
                            {
                                $('#CloseSteps').css("display", "none");
                                $('#InfSteps').css("display", "none");
                                $('#backInf').css("display", "none");
                                if(indice == 2)
                                {
                                    $('#idDocReject').css("display", "block");
                                    $('#idDocRev').css("display", "block");
                                }
                                else
                                {
                                    $('#idDocReject').css("display", "none");
                                    $('#idDocRev').css("display", "none");
                                }

                                //$('#idBack').removeClass("btn-danger").addClass("btn-light");
                            }
                        });
                        }
                    }

                }
                else 
                {
                    SystemServerError()
                }

            }).fail(function (xhr, status, error) 
            {
                    swalErrorServer()
            })
        }
    }
</script>

@*Service Menu *@
<script type="text/javascript">
    function showCapture(IdMenuService)
    {
        if(IdMenuService != "")
        {
           BlockPantalla.block();

            $.ajax({
            url: "@Url.Action("ServiceMenuPartial","Home")",
            type: "post",
            data: {IdMenuService : IdMenuService},
                beforeSend: function (xhr) {
                xhr.setRequestHeader("XSRF-TOKEN",
                    $('input:hidden[name="__RequestVerificationToken"]').val());
                },
            }).done(function (result) 
            {
                if (result != null) 
                {
                    if (result == 'Error') {
                        SystemServerError()
                    }
                    else if (result == 'noSession') {
                        swalExpired()
                    }
                    else if (result == 'Sorry') {
                        swalNoAuthorized()
                    }
                    else if (result == 'NoPage') {
                        swalNoAuthorized()
                    }
                    else
                    {
                        BlockPantalla.release();

                        $("#ServiceMenuPartial").html(result)

                        KTApp.init();

                        document.getElementById('ServiceMenuPartial').style.display = 'block';
                        document.getElementById('card1').style.display = 'none';
                        document.getElementById('card2').style.display = 'none';
                    }
                }
                else
                {
                    BlockPantalla.release();
                        SystemServerError()
    
                }
            }).fail(function (xhr, status, error) 
            {
                    swalErrorServer()
            })
        }
    }
</script>

}